# ğŸ® PK Battle Mode - Complete Guide

## ğŸ¯ What is PK Battle Mode?

**TikTok-style Player Knockout (PK) Battle** - A competitive live streaming mode where two teams battle for points through viewer gifts!

**Like Soccer Scoring:**
- Round-based competition (default: 60 minutes per round)
- Team with most points wins the round
- Score tracked like soccer: `Team A [2] - [1] Team B`
- Infinite rounds until you end the stream

---

## ğŸ“ Layout Design

### Vertical Content in Horizontal Window

```
Window: 1920 x 1080 (Horizontal)
Content: Arranged VERTICALLY

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚
â”‚  â•‘   TOP BUBBLE ZONE            â•‘   â”‚ â† Like/Comment
â”‚  â•‘   ğŸ’¬ â¤ï¸ ğŸ‘¥                  â•‘   â”‚   bubbles (random)
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  TEAM A    [2] - [1]   TEAM B â”‚  â”‚ â† SCORE
â”‚  â”‚                               â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”‚  â”‚
â”‚  â”‚  â”‚ Photo â”‚       â”‚ Photo â”‚   â”‚  â”‚ â† PHOTOS
â”‚  â”‚  â”‚   A   â”‚       â”‚   B   â”‚   â”‚  â”‚   (Draggable!)
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚  â”‚
â”‚  â”‚                               â”‚  â”‚
â”‚  â”‚  15,750 pts  |  7,320 pts    â”‚  â”‚ â† POINTS
â”‚  â”‚                               â”‚  â”‚
â”‚  â”‚  Time: 45:23 / 60:00         â”‚  â”‚ â† TIMER
â”‚  â”‚                               â”‚  â”‚
â”‚  â”‚  [â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–‘â–‘â–‘â–‘â–‘â–‘â–‘â–‘]           â”‚  â”‚ â† BAR
â”‚  â”‚   68%  vs  32%               â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—   â”‚
â”‚  â•‘   BOTTOM BUBBLE ZONE         â•‘   â”‚ â† GIFT bubbles
â”‚  â•‘   ğŸâ†’A        ğŸâ†’B          â•‘   â”‚   (Directional!)
â”‚  â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Monitor Setup:
- Rotate monitor 90Â° (landscape â†’ portrait)
- OR in OBS: Transform â†’ Rotate 90Â°
```

---

## ğŸ Gift Point System

### Point Calculation

**Formula:** `Gift Coins Ã— 5 = Points`

Examples:
- Rose (1 coin) = **5 points**
- Doughnut (30 coins) = **150 points**
- Castle (20,000 coins) = **100,000 points**
- Universe (50,000 coins) = **250,000 points**

### Gift Assignment

**ALL gifts must be assigned to Team A or Team B!**

```
Gifts Tab â†’ Assignment UI:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Gift Name    â”‚ Coins â”‚ Team    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Rose         â”‚   1   â”‚ (â€¢)A ( )B â”‚
â”‚ Castle       â”‚20,000 â”‚ ( )A (â€¢)B â”‚
â”‚ Universe     â”‚50,000 â”‚ (â€¢)A ( )B â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Quick Actions:
- [Assign All â†’ Team A]
- [Assign All â†’ Team B]
- [Split 50-50]
```

**When gift received:**
1. System checks assignment
2. Adds points to correct team
3. Gift bubble appears on that team's side

---

## âš½ Round System (Like Soccer!)

### How Rounds Work

```
Round 1 (60 minutes):
  Team A: 15,750 points
  Team B:  7,320 points

  Timer: 00:00
  â†’ Team A WINS! ğŸ†

  Score Update: [1] - [0]

  5 seconds later...
  â†’ Points RESET to 0
  â†’ Timer RESTART to 60:00
  â†’ Round 2 begins automatically!
```

### Score Tracking

```
Current State:
TEAM A  [5] - [3]  TEAM B

This means:
- Team A won 5 rounds
- Team B won 3 rounds
- Total 8 rounds played
```

### Win Effects

When a team wins a round:
1. **Visual Effect:** Screen animation from winning side
2. **Sound Effect:** `team_a_win.mp3` or `team_b_win.mp3`
3. **Log Message:** "ğŸ† TEAM A WINS THE ROUND!"
4. **5 second celebration pause**
5. **Auto-reset and continue**

---

## ğŸ«§ Bubble System

### Two Bubble Zones

**TOP Zone (Like/Comment/Follow):**
- âœ… Random placement
- âœ… Existing bubble effects
- âŒ NO points added (just decoration!)
- Purpose: Memeriahkan suasana

**BOTTOM Zone (Gifts):**
- âœ… Directional placement
  - Team A gifts â†’ LEFT side
  - Team B gifts â†’ RIGHT side
- âœ… Points added based on gift value
- âœ… Gift tier effects (micro to mega)

### Bubble Behavior

```
Event Type:     Zone:      Position:     Points:
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
Like            TOP        Random        NO
Comment         TOP        Random        NO
Follow          TOP        Random        NO
Join            TOP        Random        NO
Share           TOP        Random        NO

Gift â†’ Team A   BOTTOM     Left side     YES (coinsÃ—5)
Gift â†’ Team B   BOTTOM     Right side    YES (coinsÃ—5)
```

---

## ğŸ“¸ Photo Management

### Upload Photos

```
Photos Tab:
1. Click "Browse Photo for Team A"
2. Select image (PNG, JPG, WEBP, any format)
3. Photo loads automatically
4. Repeat for Team B
```

### Customize Photos

**Drag to Move:**
- Click and hold photo
- Drag to desired position
- Release to set

**Resize:**
- Hover near photo edge/corner
- Cursor changes to resize icon
- Drag to resize (100px - 600px)

**Features:**
- âœ… Circular crop automatically
- âœ… Team color border (Red for A, Teal for B)
- âœ… Positions saved during session

---

## âš™ï¸ Settings & Controls

### Battle Tab

**Round Duration:**
- Default: 60 minutes
- Range: 1 - 180 minutes
- Can change anytime (affects next round)

**Controls:**
- â–¶ï¸ **Start Battle** - Begin timer and scoring
- â¸ï¸ **Pause** - Pause timer (resume later)
- ğŸ”„ **Reset All** - Reset scores and points to 0

**Sound Settings:**
- â˜‘ï¸ Enable Win Sounds
- Volume slider (0-100%)

### TikTok Tab

**Connect to Live:**
1. Enter TikTok username (without @)
2. Click "Connect to Live"
3. Status shows "Connected" when ready
4. Gifts automatically processed!

**Disconnect:**
- Click "Disconnect" to stop

### Photos Tab

**Team A Photo:**
- Browse and upload
- Preview shown

**Team B Photo:**
- Browse and upload
- Preview shown

### Gifts Tab

**Gift Assignment:**
- List of ALL TikTok gifts (~94 total)
- Search filter
- Assign each to Team A or B
- **MUST save after changes!**

**Quick Actions:**
- Assign all to Team A
- Assign all to Team B
- Split 50-50 (alternating)

### Test Tab

**Simulation Controls:**
- â¤ï¸ Simulate Like
- ğŸ’¬ Simulate Comment
- ğŸ Simulate Gift â†’ Team A (random gift from A's list)
- ğŸ Simulate Gift â†’ Team B (random gift from B's list)
- ğŸš€ Rapid Test (10 random events)

---

## ğŸ¬ Quick Start Guide

### Step 1: Setup Photos (1 minute)

```
1. Go to "Photos" tab
2. Upload Team A photo
3. Upload Team B photo
4. (Optional) Drag/resize on main display
```

### Step 2: Assign Gifts (2 minutes)

```
1. Go to "Gifts" tab
2. Click "Split 50-50" for quick setup
   OR manually assign each gift
3. Click "ğŸ’¾ Save Gift Assignment"
```

### Step 3: Test Everything (1 minute)

```
1. Go to "Test" tab
2. Click "ğŸ Simulate Gift â†’ Team A"
3. Check:
   - Points increase for Team A âœ“
   - Bubble appears on LEFT âœ“
   - Bar moves âœ“
4. Click "ğŸ Simulate Gift â†’ Team B"
5. Check same for Team B
```

### Step 4: Start Battle (30 seconds)

```
1. Go to "Battle" tab
2. Check round duration (default: 60 min)
3. Click "â–¶ï¸ Start Battle"
4. Timer starts counting down!
```

### Step 5: Connect to TikTok Live

```
1. Go to "TikTok" tab
2. Enter username: "yourusername"
3. Click "ğŸ”Œ Connect to Live"
4. Wait for "Connected" status
5. Gifts now automatically tracked!
```

### Step 6: Stream!

```
- OBS: Add window capture
- Rotate 90Â° if needed
- Start streaming!
- Gifts add points automatically
- Rounds auto-reset
```

---

## ğŸ”Š Sound Files

### Required Sound Files

Place in `sounds/` folder:

```
sounds/
â”œâ”€â”€ team_a_win.mp3      (plays when Team A wins round)
â”œâ”€â”€ team_b_win.mp3      (plays when Team B wins round)
â”œâ”€â”€ round_end_warning.mp3  (plays at 10 seconds remaining)
â””â”€â”€ final_win.mp3       (optional - future use)
```

### If No Sound Files

App creates placeholder files automatically.
Replace with actual MP3 files for real sound effects!

**Where to get sounds:**
- Record your own
- Download from freesound.org
- Use AI voice generator
- Text-to-speech: "Team A wins!"

---

## ğŸ“Š Statistics Display

### Real-time Stats

**Score:** `TEAM A [5] - [3] TEAM B`
- Rounds won by each team

**Points:** `15,750 pts | 7,320 pts`
- Current round points

**Timer:** `Time: 45:23 / 60:00`
- Minutes:Seconds remaining

**Bar:** Visual percentage
- Red (Team A) vs Teal (Team B)
- Shows point distribution

---

## ğŸ¨ Customization

### Team Colors

**Team A:**
- Color: Red/Pink `#FF6B6B`
- Photo border: Red
- Points display: Red
- Bar: Red gradient

**Team B:**
- Color: Teal/Cyan `#4ECDC4`
- Photo border: Teal
- Points display: Teal
- Bar: Teal gradient

### Change Colors

Edit `pk_main_window.py`:
```python
# Team A color
QColor(255, 107, 107)  # RGB

# Team B color
QColor(78, 205, 196)   # RGB
```

---

## ğŸ› Troubleshooting

### "No gifts assigned to Team X!"

**Problem:** Tried to simulate gift but no gifts assigned
**Solution:** Go to Gifts tab â†’ Assign gifts â†’ Save

### "Sound file not found"

**Problem:** Sound files missing
**Solution:** Add MP3 files to `sounds/` folder

### Photos not showing

**Problem:** Photo upload failed
**Solution:** Check file format (PNG, JPG, WEBP supported)

### Bubbles not appearing

**Problem:** Bubble zone might be hidden
**Solution:** Check if bubbles are behind PK view (z-index issue)

### Timer not starting

**Problem:** Battle not started
**Solution:** Go to Battle tab â†’ Click "â–¶ï¸ Start Battle"

---

## ğŸ’¡ Pro Tips

### Tip 1: Gift Strategy

```
High-value gifts â†’ Team you want to promote
Example:
- Team A = Your main streamer
- Assign Universe, Castle, Lion â†’ Team A
- Assign smaller gifts â†’ Team B for balance
```

### Tip 2: Testing Before Live

```
1. Set round duration to 1 minute
2. Test with simulation
3. Verify everything works
4. Change back to 60 minutes
5. Go live!
```

### Tip 3: OBS Setup

```
OBS Scene:
1. Add Window Capture â†’ PK Battle App
2. Transform â†’ Rotate 90Â° CW
3. Resize to fit canvas
4. Add overlays as needed
```

### Tip 4: Monitor Setup

```
For best experience:
- Use portrait monitor (rotated 90Â°)
- OR use iPad/tablet as secondary display
- Full immersion!
```

### Tip 5: Save Configurations

```
Gift assignments save to:
  gift_assignment.json

Backup this file!
- Copy before changing
- Restore if needed
```

---

## ğŸ“ File Structure

```
livebuble/
â”œâ”€â”€ main.py                     (Entry point - UPDATED!)
â”œâ”€â”€ pk_main_window.py           (Main PK window - NEW!)
â”œâ”€â”€ pk_battle_system.py         (Score/timer logic - NEW!)
â”œâ”€â”€ photo_manager.py            (Photo widgets - NEW!)
â”œâ”€â”€ gift_assignment_widget.py   (Gift UI - NEW!)
â”œâ”€â”€ sound_manager.py            (Audio - NEW!)
â”‚
â”œâ”€â”€ bubble_widget.py            (Bubble effects - existing)
â”œâ”€â”€ effects.py                  (18 effects - existing)
â”œâ”€â”€ gift_tiers.py               (Gift values - existing)
â”œâ”€â”€ tiktok_handler.py           (TikTok connection - existing)
â”œâ”€â”€ config.py                   (Configuration - existing)
â”‚
â”œâ”€â”€ gift_assignment.json        (Auto-created)
â”‚
â””â”€â”€ sounds/                     (Create this!)
    â”œâ”€â”€ team_a_win.mp3
    â”œâ”€â”€ team_b_win.mp3
    â”œâ”€â”€ round_end_warning.mp3
    â””â”€â”€ final_win.mp3
```

---

## ğŸš€ Launch Application

```bash
# Start PK Battle Mode
python main.py
```

**On First Launch:**
1. Upload photos
2. Assign gifts
3. Save settings
4. Test with simulation
5. Ready to stream!

---

## âœ… Feature Checklist

Before going live, verify:

- [ ] Team A photo uploaded
- [ ] Team B photo uploaded
- [ ] Photos positioned correctly (drag/resize)
- [ ] ALL gifts assigned (check Gifts tab)
- [ ] Gift assignment SAVED
- [ ] Sound files in `sounds/` folder (optional)
- [ ] Sound enabled (Battle tab)
- [ ] Round duration set (default: 60 min)
- [ ] Tested with simulation
- [ ] TikTok username entered
- [ ] Connected to TikTok Live
- [ ] Battle started (timer running)
- [ ] OBS capturing correctly

---

## ğŸ‰ Summary

**What You Get:**

âœ… **PK Battle System** - Soccer-style scoring
âœ… **Gift Tracking** - Automatic point calculation
âœ… **Team Photos** - Fully customizable, drag & resize
âœ… **94 Gift Support** - All TikTok gifts assignable
âœ… **Bubble Effects** - 18 effects, directional placement
âœ… **Sound Effects** - Win celebrations
âœ… **Auto Rounds** - Infinite rounds, auto-reset
âœ… **Real-time Stats** - Score, points, timer, bar
âœ… **Vertical Layout** - Perfect for portrait streaming

**The Ultimate TikTok PK Battle Tool! ğŸ”¥**

---

**Need Help?** Check logs in Event Log panel (bottom right).

**Enjoy your PK Battles! ğŸ®ğŸ†**
